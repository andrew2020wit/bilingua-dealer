"use strict";(self.webpackChunkangular_bilingua=self.webpackChunkangular_bilingua||[]).push([[835],{6835:(O,p,s)=>{s.r(p),s.d(p,{SrtToJsonComponent:()=>E});var C=s(6814),d=s(2296),c=s(6223),g=s(9157),h=s(2032),M=s(8180),f=s(4408),t=s(5879),D=s(463);let E=(()=>{class m{constructor(i,n){this.bookService=i,this.router=n,this.srtData=[[],[]],this.title=""}clear(){window.document.location.reload()}getFormadedTime(i){const n=Math.floor(i/3600),r=Math.floor((i-3600*n)/60),e=i-3600*n-60*r;return`[${n>9?""+n:n>0?"0"+n:"00"}:${r>9?""+r:r>0?"0"+r:"00"}:${e>9?""+e:e>0?"0"+e:"00"}] `}openFile(i,n){const e=i.target?.files?.[0];if(!e)return;const o=new FileReader;o.onload=a=>{this.computeSrtData(a.target.result,n)},o.readAsText(e)}computeSrtData(i,n){this.srtData[n]=[];let r="",e="",o=0,a=0;const u=i.split("\n").map(l=>l.trim());for(let l=0;l<u.length;l++){const _=u[l];_?(0===a&&(r="id-"+n+"-"+_),1===a&&(o=this.getTimeFrom(_)),a>1&&(e=e+" "+_),a++):(a=0,isNaN(o)||this.srtData[n].push({id:r,text:e,timeFromSeconds:o,subtitleIndex:n}),e="")}}getTimeFrom(i){const n=i.slice(0,8).split(":").map(r=>+r);return 3600*n[0]+60*n[1]+n[2]}computeJsonBook(){if(!this.title||!this.srtData[0].length)return;const i=this.srtData[0],n=this.srtData[1],r=[];let e=null;this.srtData[1].length&&(e=[]),i.forEach((o,a)=>{if(r.push(this.getFormadedTime(o.timeFromSeconds)+o.text),e){let u=[];if(u=n.filter(a<i.length?l=>l.timeFromSeconds>=i[a].timeFromSeconds&&l.timeFromSeconds<i[a+1].timeFromSeconds:l=>l.timeFromSeconds>=i[a].timeFromSeconds),u?.length){const l=u.map(Z=>Z.text).join("\n");e.push(this.getFormadedTime(u[0].timeFromSeconds)+l)}else e.push("")}}),this.bookService.create$(this.title,r,e).pipe((0,M.q)(1)).subscribe({next:o=>{this.router.navigate(["/book",o[0].id])}})}}return m.\u0275fac=function(i){return new(i||m)(t.Y36(D.Z),t.Y36(f.F0))},m.\u0275cmp=t.Xpm({type:m,selectors:[["app-srt-to-json"]],standalone:!0,features:[t.jDz],decls:34,vars:3,consts:[[1,"title"],[1,"header"],[1,"open-file"],["mat-button","","color","primary",3,"click"],["type","file","hidden","",3,"change"],["fileInput0",""],["fileInput1",""],["mat-button","","color","warn",3,"click"],["mat-button","","color","primary","routerLink","/"],["appearance","outline",1,"book-title"],["matInput","","required","",3,"ngModel","ngModelChange"],[1,"info"],[1,"length"],["target","_blank","href","https://en.wikipedia.org/wiki/Subtitle_Edit"]],template:function(i,n){if(1&i){const r=t.EpF();t.TgZ(0,"div",0),t._uU(1," Import srt - files (subtitle files, utf-encoding)\n"),t.qZA(),t.TgZ(2,"div",1)(3,"div",2)(4,"button",3),t.NdJ("click",function(){t.CHM(r);const o=t.MAs(7);return t.KtG(o.click())}),t._uU(5," Open srt file (original, required) "),t.qZA(),t.TgZ(6,"input",4,5),t.NdJ("change",function(o){return n.openFile(o,0)}),t.qZA()(),t.TgZ(8,"div",2)(9,"button",3),t.NdJ("click",function(){t.CHM(r);const o=t.MAs(12);return t.KtG(o.click())}),t._uU(10," Open srt file (translation) "),t.qZA(),t.TgZ(11,"input",4,6),t.NdJ("change",function(o){return n.openFile(o,1)}),t.qZA()(),t.TgZ(13,"button",3),t.NdJ("click",function(){return n.computeJsonBook()}),t._uU(14,"Create bilingua book"),t.qZA(),t.TgZ(15,"button",7),t.NdJ("click",function(){return n.clear()}),t._uU(16,"Clear"),t.qZA(),t.TgZ(17,"button",8),t._uU(18,"go Home"),t.qZA()(),t.TgZ(19,"mat-form-field",9)(20,"mat-label"),t._uU(21,"Books Title"),t.qZA(),t.TgZ(22,"input",10),t.NdJ("ngModelChange",function(o){return n.title=o}),t.qZA()(),t.TgZ(23,"div",11)(24,"div",12),t._uU(25),t.qZA(),t.TgZ(26,"div",12),t._uU(27),t.qZA(),t.TgZ(28,"div"),t._uU(29,"You have to use UTF-8 for srt-files."),t.qZA(),t.TgZ(30,"div"),t._uU(31,"You can use Subtitle Edit to exract subtitles "),t.TgZ(32,"a",13),t._uU(33,"https://en.wikipedia.org/wiki/Subtitle_Edit"),t.qZA()()()}2&i&&(t.xp6(22),t.Q6J("ngModel",n.title),t.xp6(3),t.hij("original: ",null==n.srtData[0]?null:n.srtData[0].length,""),t.xp6(2),t.hij("translation: ",null==n.srtData[1]?null:n.srtData[1].length,""))},dependencies:[C.ez,d.ot,d.lW,c.u5,c.Fj,c.JJ,c.Q7,c.On,g.lN,g.KE,g.hX,h.c,h.Nt,f.rH],styles:["[_nghost-%COMP%]{display:block;margin:auto;max-width:800px;width:-moz-fit-content;width:fit-content}.header[_ngcontent-%COMP%]{display:flex;gap:8px;padding:16px}.book-title[_ngcontent-%COMP%]{width:100%}.title[_ngcontent-%COMP%]{padding:16px;font-size:large}.info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{padding:8px}"]}),m})()}}]);